{% extends 'blog/base.html' %}
{% load static %}

{% block title %}{{ category.name }}{% endblock %}

{% block content %}
<h1>{{ category.name }}</h1>

<form method="get">
    <div class="form-group">
        <label for="date">Filter by Date:</label>
        <input type="date" id="date" name="date" class="form-control" value="{{ date_filter }}">
    </div>
    <button type="submit" class="btn btn-primary">Filter</button>
</form>

<ul class="list-group mt-4">
    {% for post in page_obj %}
        <li class="list-group-item">
            <a href="{% url 'post_detail' category.slug post.slug %}">
                {% if post.preview_image %}
                    <img src="{{ post.preview_image.url }}" class="img-thumbnail float-left mr-3" alt="{{ post.title }}">
                {% endif %}
                <h2>{{ post.title }}</h2>
            </a>
            <p>{{ post.summary }}</p>
            <small>Published on: {{ post.publication_date }}</small>
        </li>
    {% endfor %}
</ul>

<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1{% if date_filter %}&date={{ date_filter }}{% endif %}">First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if date_filter %}&date={{ date_filter }}{% endif %}">Previous</a>
            </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% elif num > page_obj.number|add:'-5' and num < page_obj.number|add:'5' %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}{% if date_filter %}&date={{ date_filter }}{% endif %}">{{ num }}</a></li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if date_filter %}&date={{ date_filter }}{% endif %}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if date_filter %}&date={{ date_filter }}{% endif %}">Last</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endblock %}
